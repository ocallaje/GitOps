apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: seqworks
  namespace: argocd
spec:
  project: default
  source:
    repoURL: https://github.com/ocallaje/seqworks.git
    path: deployments/dev-cluster/nest-api
    targetRevision: HEAD
  destination:
    server: https://kubernetes.default.svc
    namespace: seqworks
  syncPolicy:
    automated:
      selfHeal: true
      prune: true

# apps/argo-trigger-rbac.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: seqworks-argo-trigger
  namespace: argo-workflows
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: seqworks-trigger-role
  namespace: argo-workflows
rules:
- apiGroups: ["argoproj.io"]
  resources: ["workflows", "workflowtemplates"]
  verbs: ["get", "list", "create"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: seqworks-trigger-rolebinding
  namespace: argo-workflows
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: seqworks-trigger-role
subjects:
- kind: ServiceAccount
  name: seqworks-argo-trigger
